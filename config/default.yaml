sentinel:
  system:
    name: "SENTINEL"
    version: "0.1.0"
    log_level: "INFO"
    graceful_degradation: true    # isolate sensor failures, don't crash pipeline
    max_sensor_errors: 10         # consecutive errors before auto-disabling a sensor
    validate_config: false        # Pydantic schema validation on startup
    log_file: null                # path to log file (null = console only)
    log_json: false               # JSON log output instead of human-readable

  time:
    mode: "realtime"              # "realtime" or "simulated" (deterministic clock)
    step_size_s: 0.1              # time step per iteration (simulated mode only)
    start_epoch: 1000000.0        # initial epoch time (simulated mode only)

  sensors:
    camera:
      enabled: true
      source: 0                    # 0=USB, "rtsp://..." or "/path/to/video.mp4"
      width: 1280
      height: 720
      fps: 30
      buffer_size: 1
      backend: "auto"              # "auto", "dshow", "v4l2", "ffmpeg"

    radar:
      enabled: true
      mode: "simulator"
      scan_rate_hz: 10
      max_range_m: 10000
      fov_deg: 120
      noise:
        range_m: 5.0
        azimuth_deg: 1.0
        velocity_mps: 0.5
        rcs_dbsm: 2.0
        false_alarm_rate: 0.01
        detection_probability: 0.9
        range_dependent: false        # noise scales with (range/max_range)^2
        use_snr_pd: false             # SNR-based detection probability
      scenario:
        targets:
          - id: "TGT-01"
            position: [3000, 1000]
            velocity: [-20, 5]
            rcs_dbsm: 15
            class_name: "vehicle"
          - id: "TGT-02"
            position: [5000, -2000]
            velocity: [10, 15]
            rcs_dbsm: 10
            class_name: "vehicle"

    multifreq_radar:
      enabled: false
      mode: "simulator"
      scan_rate_hz: 10
      max_range_m: 20000
      fov_deg: 120
      bands: ["vhf", "uhf", "l_band", "s_band", "x_band"]
      band_noise:
        vhf:
          range_std_m: 50.0
          azimuth_std_deg: 5.0
        uhf:
          range_std_m: 30.0
          azimuth_std_deg: 3.0
        l_band:
          range_std_m: 15.0
          azimuth_std_deg: 2.0
        s_band:
          range_std_m: 8.0
          azimuth_std_deg: 1.5
        x_band:
          range_std_m: 5.0
          azimuth_std_deg: 1.0
      noise:
        false_alarm_rate: 0.01
        detection_probability: 0.9
      scenario:
        targets:
          - id: "STEALTH-01"
            position: [8000, 2000]
            velocity: [-150, 10]
            rcs_dbsm: -20            # Very low X-band RCS (stealth)
            target_type: "stealth"
            class_name: "stealth_aircraft"
          - id: "HYP-01"
            position: [15000, 0]
            velocity: [-1715, 0]
            rcs_dbsm: 5
            target_type: "hypersonic"
            mach: 5.0
            class_name: "hypersonic_vehicle"
          - id: "CONV-01"
            position: [5000, 1000]
            velocity: [-50, 5]
            rcs_dbsm: 15
            target_type: "conventional"
            class_name: "aircraft"

    thermal:
      enabled: false
      mode: "simulator"
      frame_rate_hz: 30
      fov_deg: 60
      max_range_m: 50000
      bands: ["mwir", "lwir"]
      noise:
        detection_probability: 0.95
        false_alarm_rate: 0.5
        min_contrast_k: 10.0
      scenario:
        targets:
          - id: "THERM-01"
            position: [8000, 2000]
            velocity: [-150, 10]
            target_type: "stealth"
            class_name: "stealth_aircraft"
          - id: "THERM-HYP-01"
            position: [15000, 0]
            velocity: [-1715, 0]
            target_type: "hypersonic"
            mach: 5.0
            class_name: "hypersonic_vehicle"
          - id: "THERM-CONV-01"
            position: [5000, 1000]
            velocity: [-50, 5]
            target_type: "conventional"
            class_name: "aircraft"

    quantum_radar:
      enabled: false
      mode: "simulator"
      scan_rate_hz: 10
      max_range_m: 15000
      fov_deg: 120
      freq_hz: 10.0e9               # X-band (10 GHz)
      squeeze_param_r: 0.1          # TMSV squeeze parameter (N_S ~ 0.01)
      n_modes: 10000                # Signal-idler mode pairs per pulse
      antenna_gain_dbi: 30
      receiver_type: "opa"           # opa, sfg, phase_conjugate, optimal
      ambient_temp_k: 290.0
      noise:
        range_std_m: 8.0
        azimuth_std_deg: 1.5
        false_alarm_rate: 0.005      # Lower than classical (quantum correlation)
      scenario:
        targets:
          - id: "QI-STEALTH-01"
            position: [8000, 2000]
            velocity: [-150, 10]
            rcs_dbsm: -20
            target_type: "stealth"
            class_name: "stealth_aircraft"
          - id: "QI-CONV-01"
            position: [5000, 1000]
            velocity: [-50, 5]
            rcs_dbsm: 15
            target_type: "conventional"
            class_name: "aircraft"

  detection:
    model: "yolov8n.pt"
    confidence: 0.25
    iou_threshold: 0.45
    device: "auto"                 # "auto", "cpu", "cuda:0", "mps"
    classes: null                   # null = all classes
    max_detections: 100
    image_size: 640

  tracking:
    filter:
      type: "kf"                   # "kf", "ekf", "ca", "imm"
      dt: 0.033                    # 1/30 FPS
      process_noise_std: 1.0       # Kalman process noise sigma_a
      measurement_noise_std: 10.0  # Kalman measurement noise diagonal
      imm:
        transition_prob: 0.98      # Markov mode-stay probability (IMM only)

    association:
      method: "hungarian"          # "hungarian" or "jpda"
      gate_threshold: 9.21         # chi2(2df) at 99%
      iou_weight: 0.5
      mahalanobis_weight: 0.5
      cascaded: false              # two-pass: confirmed tracks first
      detection_probability: 0.9   # JPDA P_D parameter
      false_alarm_density: 1.0e-6  # JPDA clutter density

    track_quality:
      enabled: true
      nis_window_size: 20          # rolling window for NIS averaging

    track_management:
      confirm_hits: 3
      confirm_window: 5            # M-of-N: confirm if M hits in N frames
      max_coast_frames: 15
      max_tracks: 100
      tentative_delete_misses: 3   # consecutive misses to delete tentative
      confirmed_coast_misses: 5    # consecutive misses to start coasting
      coast_reconfirm_hits: 2      # consecutive hits to re-confirm from coast

    radar:
      filter:
        type: "ekf"                  # "ekf", "ca", "imm"
        dt: 0.1                      # 1/10 Hz radar
        process_noise_std: 1.0       # m/s^2
        use_3d: false                # 3D state estimation (adds elevation)
        use_doppler: false           # Doppler velocity in EKF measurement
        elevation_noise_deg: 1.0     # elevation measurement noise (3D only)
        measurement_noise:
          range_m: 5.0
          azimuth_deg: 1.0
      association:
        method: "hungarian"          # "hungarian" or "jpda"
        gate_threshold: 9.21
        velocity_gate_mps: null    # radial velocity gate (null=disabled)
        cascaded: false            # two-pass: confirmed tracks first
        detection_probability: 0.9   # JPDA P_D
        false_alarm_density: 1.0e-6  # JPDA clutter density
      track_management:
        confirm_hits: 3
        max_coast_frames: 5
        max_tracks: 50

    thermal:
      filter:
        type: "bearing_ekf"
        dt: 0.033                    # 1/30 Hz thermal
        assumed_initial_range_m: 10000.0
      association:
        method: "hungarian"          # "hungarian" or "jpda"
        gate_threshold: 6.635       # chi2(1df) at 99% -- bearing-only is 1 DOF
        detection_probability: 0.9   # JPDA P_D
        false_alarm_density: 1.0e-6  # JPDA clutter density
      track_management:
        confirm_hits: 3
        max_coast_frames: 10
        max_tracks: 50

    quantum_radar:
      filter:
        type: "ekf"
        dt: 0.1                      # 1/10 Hz (same as classical radar)
        process_noise_std: 1.0
        measurement_noise:
          range_m: 8.0
          azimuth_deg: 1.5
      association:
        method: "hungarian"
        gate_threshold: 9.21
      track_management:
        confirm_hits: 3
        max_coast_frames: 5
        max_tracks: 50

  fusion:
    enabled: true
    camera_hfov_deg: 60.0
    azimuth_gate_deg: 5.0
    thermal_azimuth_gate_deg: 3.0
    min_fusion_quality: 0.3
    temporal_alignment: false         # predict tracks to common epoch before fusion
    use_statistical_distance: false   # Mahalanobis track-to-track for correlation
    statistical_distance_gate: 9.21   # chi2(2df) gate for statistical correlation
    multifreq_correlation:
      range_gate_m: 500.0
      azimuth_gate_deg: 3.0
    threat_classification:
      method: "rule_based"                  # "rule_based" or "ml"
      model_path: "models/threat_classifier.joblib"
      confidence_threshold: 0.6             # below this, fall back to rule-based
      intent_estimation: false              # enable kinematic intent estimation
      hypersonic_temp_threshold_k: 1500.0
      stealth_rcs_variation_db: 15.0

  environment:
    terrain:
      enabled: false                   # Enable terrain masking (line-of-sight)
      type: "flat"                     # flat | procedural | ridge
      resolution_m: 100.0             # Grid cell size
      extent_m: 50000.0               # Grid extent in each direction
      max_elevation_m: 500.0          # Max hill height (procedural only)
      seed: null                       # RNG seed for procedural generation
    weather:
      enabled: false                   # Enable weather effects on sensors
      rain_rate_mm_h: 0.0             # 0=clear, 4=moderate, 16=heavy, 50+=extreme
      humidity_pct: 50.0
      temperature_k: 290.0
      visibility_km: 20.0
      cloud_cover_pct: 0.0            # 0-100, affects thermal background
      wind_speed_mps: 0.0
      sea_state: 0                     # Douglas scale 0-9
    atmosphere:
      enabled: false                   # Enable atmospheric propagation losses
    clutter:
      enabled: false                   # Enable surface/rain clutter model
      surface_sigma0_db: -30.0        # Ground reflectivity
      sea_clutter: false
      rain_clutter: false
    sensor_position:
      x_m: 0.0
      y_m: 0.0
      altitude_m: 0.0                 # Meters above sea level
    ew:
      enabled: false                   # Enable electronic warfare effects
      jammers: []                      # List of jammer configs
      chaff_clouds: []                 # List of chaff cloud configs
      decoys: []                       # List of decoy configs
      eccm:
        sidelobe_blanking: false
        frequency_agility: false
        burn_through_mode: false
        quantum_eccm: false
        quantum_eccm_advantage_db: 6.0
      radar_peak_power_w: 1000000.0
      radar_gain_db: 30.0
      radar_bandwidth_hz: 1000000.0

  iff:
    enabled: false                     # Enable IFF interrogation system
    max_interrogation_range_m: 400000.0  # Max IFF interrogation range (~216 NM)
    interrogation_rate_hz: 1.0         # IFF queries per second
    modes: ["mode_3a", "mode_c"]       # IFF modes to interrogate
    require_mode_4: false              # Require Mode 4 crypto for FRIENDLY
    require_mode_5: false              # Require Mode 5 crypto for FRIENDLY
    spoof_detection_enabled: true      # Cross-check crypto + kinematics
    spoof_detection_threshold: 0.7     # Spoof score above this = SPOOF_SUSPECT
    no_response_hostile_threshold: 3   # Consecutive no-responses → ASSUMED_HOSTILE
    controlled_airspace: false         # Unidentified in controlled → WEAPONS_TIGHT
    friendly_codes: []                 # Known-friendly Mode 3/A squawk codes

  roe:
    enabled: false                     # Enable Rules of Engagement engine
    default_posture: "weapons_hold"    # Default engagement authorization
    friendly_override: true            # FRIENDLY IFF always → HOLD_FIRE
    hostile_attack_posture: "weapons_free"
    hostile_no_attack_posture: "weapons_tight"
    unknown_controlled_posture: "weapons_tight"
    spoof_posture: "weapons_free"
    critical_threat_posture: "weapons_free"

  geo_reference:
    enabled: false
    lat: 0.0
    lon: 0.0
    alt: 0.0
    name: ""

  # ---------- Engagement Zones (Phase 21) ----------
  engagement:
    enabled: false                     # Enable engagement zone system
    pk_weight: 0.4                     # Pk weight in assignment cost
    tti_weight: 0.3                    # TTI weight in assignment cost
    threat_weight: 0.3                 # Threat priority weight in cost
    max_tti_s: 120.0                   # TTI normalization ceiling (seconds)
    default_zone_auth: "weapons_free"  # Default zone authorization
    zones: []                          # List of zone definitions
    weapons: []                        # List of weapon profiles

  # ---------- Network Integration (Phase 20) ----------
  network:
    enabled: false                     # Enable tactical mesh networking
    node_id: "LOCAL"                   # Unique node identifier
    role: "sensor"                     # sensor/fusion_center/command/relay
    capabilities: []                   # Auto-detected from active sensors
    transport:
      type: "simulated"               # simulated (in-process mesh)
      latency_ms: 5.0                 # Base one-way latency (ms)
      jitter_ms: 2.0                  # Random jitter +/- (ms)
      packet_loss_rate: 0.0           # Drop probability 0.0-1.0
      bandwidth_bps: 10000000         # 10 Mbps (TTNT-class)
      reorder_probability: 0.0        # Out-of-order delivery probability
    pubsub:
      track_publish_hz: 1.0           # Track report publish rate
      detection_publish_hz: 10.0      # Detection report publish rate
      heartbeat_interval_s: 2.0       # Node heartbeat interval
      history_depth: 5                # Messages retained per topic
      message_lifespan_s: 10.0        # Auto-expire stale messages
    discovery:
      auto_discover: true             # Automatic peer discovery
      heartbeat_timeout_s: 6.0        # Peer offline after 3x heartbeat
    composite_fusion:
      enabled: true                   # Merge remote tracks with local
      distance_gate: 50.0             # Mahalanobis distance gate
      stale_threshold_s: 5.0          # Discard remote tracks older than this
      prefer_local: true              # Bias toward local track positions

  ui:
    hud:
      enabled: true
      display: true
      overlay_alpha: 0.85
      colors:
        tentative: [0, 255, 255]     # Yellow (BGR)
        confirmed: [0, 255, 0]       # Green
        coasting: [0, 165, 255]      # Orange
        reticle: [0, 255, 0]         # Green
        text: [0, 255, 0]            # Green
        border: [0, 180, 0]          # Dark green
        danger: [0, 0, 255]          # Red
        background: [0, 20, 0]       # Dark green tint
        radar: [255, 200, 0]         # Cyan for radar tracks (BGR)
        fused: [255, 255, 0]         # Bright cyan for fused (BGR)
        thermal: [0, 100, 255]       # Orange-red for thermal (BGR)
        stealth: [200, 0, 200]       # Magenta for stealth targets
        hypersonic: [0, 0, 255]      # Red for hypersonic targets
        quantum: [255, 100, 200]     # Pink-cyan for quantum radar (BGR)
        threat_critical: [0, 0, 255] # Bright red
        threat_high: [0, 80, 255]    # Orange-red
        threat_medium: [0, 200, 255] # Yellow
        threat_low: [0, 200, 0]      # Green
      scanline:
        enabled: true
        spacing: 3
        alpha: 0.03

    web:
      enabled: false               # Disabled until Phase 6
      host: "0.0.0.0"
      port: 8080
      track_update_hz: 10
      video_stream_fps: 15
